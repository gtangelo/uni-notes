# The Fast Fourier Transform

## Complex Numbers

Complex numbers $z = a + ib$ can be represented using their *modulus* $\|z\| = \sqrt{a^2 + b^2}$ and their *argument*, $\arg(z)$, which is an angle taking values in $(-\pi, \pi]$ and satisfying 

$$
z = \|z\| e^{i \arg(z)} = \|z\| (\cos \arg(z) + i \sin \arg(z))
$$

Recall that 

$$
z^n = \left(\|z\| e^{i \arg(z)}\right)^n = \|z\|^n e^{i n \arg(z)} = \|z\|^n(\cos(n\arg(z)) + i \sin(n \arg(z)))
$$

### Complex Roots Of Unity

Roots of unity of order $n$ are complex numbers which satisfy $z^n = 1$.

If $z^n = \|z\|^n (\cos(n \arg(z)) + i \sin(n \arg(z))) = 1$ then $\|z\| = 1$ and $n \arg(z)$ is a multiple of $2 \pi$.

Thus, $n \arg(z) = 2 \pi k$, i.e. $\arg(z) = \dfrac{2\pi k}{n}$.

We denote $\omega_n = e^{i 2\pi / n}$. Such $\omega_n$ is called a *primitive root of unity of order $n$*. A root of unity $\omega$ of order $n$ is primitive is all other roots of unity of the same order can be obtained as its powers $\omega^k$.

We have $\omega_n = e^{i 2\pi/n} \equiv \cos \dfrac{2\pi}{n} + i \sin \dfrac{2\pi}{n}$.

For $\omega_n = e^{i 2\pi / n}$ and for all $k$ such that $0 \le k \le n - 1$,

$$
((\omega_n)^k)^n = (\omega_n)^{nk} = ((\omega_n)^n)^k = 1^k = 1
$$

Thus, $\omega_n^k = (\omega_n)^k$ is also a root of unity.

Since $\omega_n^k$ are roots of unity for $k = 0, 1, \dots, n - 1$ and there are at most $n$ distinct roots of unity of order $n$, we conclude that every root of unity of order $n$ must be of the form $\omega_n^k$.

For the product of any two roots of unity $\omega_n^k$ and $\omega_n^m$ of the same order, we have $\omega_n^k \omega_n^m = \omega_n^{k + m}$.

If $k + m \ge n$ then $k + m = n + l$ for $l = (k + m) \mod n$, and we have $\omega_n^k = \omega_n^m = \omega_n^{k + m} = \omega_n^{n + l} = \omega_n^n \omega_n^l = 1 \cdot \omega_n^l = \omega_n^l$ where $0 \le l < n$.

Thus, the product of any two roots of unity of the same order is just another root of unity of the same order.

So in the set of all roots of unity of order $n$, i.e. $\{ 1, \omega_n, \omega_n^2, \dots, \omega_n^{n - 1} \}$ we can multiply any two elements or raise an element to any power without going out of this set.

#### Cancellation Lemma

The **cancellation lemma** states that $\omega_{kn}^{km} = \omega_n^m$ for all integers $k, m, n$.

## The Discrete Fourier Transform

Let $A = \langle A_0, A_1, \dots, A_{n - 1} \rangle$ be a sequence of $n$ real or complex numbers. 

We can form the corresponding polynomial $P_A(x) = \sum_{j = 0}^{n - 1} A_j x^j$ and evaluate it at all complex roots of unity of order $n$, i.e. we compute $P_A(\omega_n^l)$ for all $0 \le k \le n - 1$.

The sequence of values $\langle P_A(1), P_A(\omega_n), P_A(\omega_n^2), \dots, P_A(\omega_n^{n - 1}) \rangle$ is called the **Discrete Fourier Transform (DFT)** of the sequence $A$.

The value $P_A(\omega_n^k)$ is usually denoted by $\hat{A}\_k$ and the sequence of values $\langle P_A(1), P_A(\omega_n), P_A(\omega_n^2), \dots, P_A(\omega_n^{n - 1}) \rangle$ is usually denoted by $\hat{A} = \langle \hat{A}\_0, \hat{A}\_1, \dots, \hat{A}\_{n - 1} \rangle$.

The DFT $\hat{A}$ of a sequence $A$ can be computed *very fast* using a divide-and-conquer algorithm called the **Fast Fourier Transform**.

To multiply polynomials using the Discrete Fourier Transform we:

1. Define two polynomials
$$
\begin{array}{lcl}
  P_A(x) & = & A_0 + \dots + A_{n - 1}x^{n - 1} \\
  P_B(x) & = & B_0 + \dots + B_{m - 1}x^{m - 1} \\
\end{array}
$$
2. Pad $A$ with $m - 1$ zeros at the end, $(A\_0, A\_1, \dots, A\_{n - 1}, \underbrace{0, \dots, 0}\_{m - 1})$ to make it of length $m + n - 1$, and similarly pad $B$ with $n - 1$ zeros at the end, $(B_0, B_1, \dots, B_{m - 1}, \underbrace{0, \dots, 0}_{n - 1})$ to also obtain a sequence of length $n + m - 1$
3. Compute the DFT of both $P_A$ and $P_B$
$$
\begin{array}{lcl}
  DFT(\langle A_0, A_1, \dots, A_{n - 1}, \underbrace{0, \dots, 0}_{m - 1}) \rangle & = & \langle \hat{A}_0, \hat{A}_1, \dots, \hat{A}_{n + m - 2}) \\
  DFT(\langle B_0, B_1, \dots, B_{m - 1}, \underbrace{0, \dots, 0}_{n - 1}) \rangle & = & \langle \hat{B}_0, \hat{B}_1, \dots, \hat{B}_{n + m - 2}) \\
\end{array}
$$
4. For each $k$, multiply the corresponding values $\hat{A}\_k = P\_A(\omega\_{n + m - 1}^k)$ and $\hat{B}\_k = P_B(\omega\_{n + m - 1}^k)$ thus obtaining
$$
\hat{C}_k = \hat{A}_k \hat{B}_k = P_A(\omega_{n + m - 1}^k) P_B(\omega_{n + m - 1}^k) = P_C(\omega_{n + m - 1}^k)
$$
5. Use the inverse transformation for DFT, called IDFT, to recover the coefficients $\langle C\_0, C\_1, \dots, C\_{n + m - 1} \rangle$ of the product polynomial $P\_C(x)$ from the sequence $\langle \hat{C}\_0, \hat{C}\_1, \dots, \hat{C}\_{n + m - 1} \rangle$ of its values $C_k = P_C(\omega_{n + m - 1}^k)$ at the roots of unity of order $n + m - 1$

## The Fast Fourier Transform

Given a sequence $A = \langle A_0, A_1, \dots, A_n \rangle$ we want to compute its DFT. This amounts to finding values of $P_A(x)$ for all $x = \omega_n^k, 0 \le k \le n - 1$.

The main idea of the Fast Fourier Transform (FFT) algorithm is to divide-and-conquer by splitting the polynomial $P_A(x)$ into the even powers and the odd powers:

$$
\begin{array}{lcl}
  P_A(x) & = & (A_0 + A_2 x^2 + A_4 x^2 + \dots + A_{n - 2} x^{n - 2}) + (A_1 x + A_3 x^3 + \dots + A_{n - 1} x^{n - 1}) \\
  & = & A_0 + A_2 x^2 + A_4 (x^2)^2 + \dots + A_{n - 2} (x^2)^{n/2 - 1} + x(A_1 + A_3 x^2 + A_5 (x^2)^2 + \dots + A_{n - 1} (x^2)^{n/2 - 1})
\end{array}
$$

We then define

$$
A^{[0]} = \underbrace{\langle A_0, A_2, A_4, \dots, A_{n - 2} \rangle}_{\text{even coefficients of $P_A(x)$}} 
\qquad 
A^{[1]} = \underbrace{\langle A_1, A_3, A_5, \dots, A_{n - 1} \rangle}_{\text{odd coefficients of $P_A(x)$}}
$$

and construct the polynomials

$$
\begin{array}{lcl}
  P_{A_{[0]}}(y) & = & A_0 + A_2 y + A_4 y^2 + \dots + A_{n - 1} y^{n / 2 - 1} \\
  P_{A_{[1]}}(y) & = & A_1 + A_3 y + A_5 y^2 + \dots + A_{n - 1} y^{n / 2 - 1} \\
\end{array}
$$

so $P_A(x) = P_{A^{[0]}}(x^2) + x P_{A^{[1]}}(x^2)$.

Note that the number of coefficients of the polynomials $P_{A^{[0]}}(y)$ and $P_{A^{[1]}}(y)$ is $n/2$ each, while the number of coefficients of the polynomial $P_A(x)$ is $n$.

As such, we have reduced evaluation of our polynomial $P_A(x)$ with $n$ coefficients at inputs $x = \omega_n^0, x = \omega_n^1, x = \omega_n^2, \dots, x = \omega_n^{n - 1}$ to evaluation of two polynomials $P_{A^{[0]}}(y)$ and $P_{A^{[1]}}(y)$ each with $n/2$ coefficients, at points $y = x^2$ for the same values of inputs $x$.

However, as $x$ ranges through values $\{ \omega_n^0, \omega_n^1, \dots, \omega_n^{n - 1} \}$, the value of $y = x^2$ ranges through $\{ \omega_{n/2}^0, \omega_{n/2}^2, \omega_{n/2}^2, \dots, \omega_{n/2}^{n - 1} \}$, and there are only $n/2$ distinct such values.

Once we get these $n/2$ values of $A^{[0]}(x^2)$ and $A^{[1]}(x^2)$ we need $n$ additional multiplications with numbers $\omega_n^k$ to obtain the values of

$$
\begin{array}{lcl}
  P_A(\omega_n^k) & = & P_{A^{[0]}}((\omega_n^k)^2) + \omega_n^k \cdot P_{A^{[1]}}((\omega_n^k)^2) \\
  & = & P_{A^{[0]}}(\omega_{n/2}^k) + \omega_n^k \cdot P_{A^{[1]}}(\omega_{n/2}^k) \\
\end{array}
$$

Thus, we have reduced a problem of size $n$ to two such problems of size $n/2$, plus a linear overhead.

### A Simplification

By the Cancelation Lemma, $\omega_n^{n/2} = \omega_{2n/2}^{n/2} = \omega_2 = -1$.

Thus, $\omega_n^{k + n/2} = \omega_n^{n/2} \omega_n^k = \omega_2 \omega_n^k = -\omega_n^k$.

We can now simplify evaluation of $P_A(\omega_n^k) = P_{A^{[0]}}(\omega_{n/2}^k) + \omega_n^k P_{A^{[1]}}(\omega_{n/1}^k)$ for $n/2 \le k < n$ as follows:

- Let $k = n/2 + m$ where $0 \le m < n/2$
- Then:
$$
\begin{array}{lcl}
  P_A(\omega_n^{n/2 + m} & = & P_{A^{[0]}}(\omega_{n/2}^{n/2+m}) + \omega_n^{n/2 + m} P_{A^{[1]}}(\omega_{n/2}^{n/2 + m}) \\
  & = & P_{A^{[0]}}(\omega_{n/2}^{n/2} \omega_{n/2}^m) + \omega_n^{n/2} \omega_n^m P_{A^{[1]}}(\omega_{n/2}^{n/2} \omega_{n/2}^m) \\
  & = & P_{A^{[0]}}(\omega_{n/2}^m) - \omega_n^m P_{A^{[1]}}(\omega_{n/2}^m) \\
\end{array}
$$

Compare this with $P_A(\omega_n^m) = P_{A^{[0]}}(\omega_{n/2}^m) + \omega_n^m P_{A^{[1]}}(\omega_{n/2}^m)$ for $0 \le m < n/2$.

So we can replace evaluations of $P_A(\omega_n^k) = P_{A^{[0]}}(\omega_{n/2}^k) + \omega_n^k P_{A^{[1]}}(\omega_{n/2}^k)$ for $k = 0$ to $k = n - 1$, with such evaluations only for $k = 0$ to $k = n/2 - 1$, and just let for $k = 0$ to $k = n/2 - 1$

$$
\begin{array}{lcl}
  P_A(\omega_n^k) & = & P_{A^{[0]}}(\omega_{n/2}^k) + \omega_n^k P_{A^{[1]}}(\omega_{n/1}^k) \\
  P_A(\omega_n^{n/2 + k}) & = & P_{A^{[0]}}(\omega_{n/2}^k) - \omega_n^k P_{A^{[1]}}(\omega_{n/1}^k) \\
\end{array}
$$

The FFT runs in $\Theta(n \log n)$ time.

## Computing Convolutions

To compute the convolution $C = A \ast B$, proceed in exactly the same manner as the FFT, except this time, start with sequences of $A = \langle A_0, \dots, A_{n - 1} \rangle$ and $B = \langle B_0, \dots, B_{n - 1} \rangle$.

That is:

1. Convert sequences to polynomial form $P_A(x)$ and $P_B(x)$ (in $\mathcal{O}(n)$ time)
2. Compute the DFT of $P_A(x)$ and $P_B(x)$ (in $\mathcal{O}(n \log n)$ time)
3. Multiply the DFT sequences together (in $\mathcal{O}(n)$ time)
4. Perform the IDFT on the result from (3) (in $\mathcal{O}(n \log n)$ time)

Overall, the convolution $C = A \ast B$ can be computed in $\mathcal{O}(n \log n)$ time.
