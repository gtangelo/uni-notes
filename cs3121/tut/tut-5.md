# Questions - Maximum Flow

## Tutorial Problems

1. In the country of Pipelistan there are several oil wells, several oil refineries and many distribution hubs connected by oil pipelines. To visualise Pipelistan’s oil infrastructure, just imagine a directed graph with $k$ source vertices (the oil wells), $m$ sinks (refineries) and $n$ vertices which are distribution hubs linked with one way pipelines. You are given the graph and the capacity $C(i, j)$ of each pipeline going from a vertex $i$ to a vertex $j$​​. You want to install the smallest possible number of flow meters on some of these pipelines so that the total throughput of oil from all the wells to all refineries can be computed exactly from the readings of all of these meters. Each meter shows the direction of the flow and the quantity of flow per minute. Design an efficient algorithm for deciding on which pipelines to place the flow meters.

   > The problem can be modelled as a max flow/min cut problem. Construct a network flow graph $G(V, E)$​ where the oil wells, refineries and distributions hubs are the vertices. However, let the wells be defined as the source and the refineries as the sinks. Since we are finding the max flow from the wells to the refineries, let there exist a super source vertex $S$​ which connects to all wells with infinite capacity and a super sink $T$​​ which connects to all sinks with infinite capacity. Furthermore, let the pipelines be represented as a pair of directed edges in the opposite direction to each other, connecting vertex $i$​ to vertex $j$​​​​​ in the graph with a maximum capacity of 1 since we are finding the smallest possible number of flow meters to attach on the pipelines.
   >
   > Perform the Edmonds Karp algorithm to find the max flow of the network graph. Since we have set the pipelines to have a maximum capacity of 1, we can use the minimal cut to find the path from the super source $S$​ to find the total quantity needed to place flow metres. By the max-flow min-cut theorem, the total capacity on the edges in the minimum cut gives us the minimum number of flow metres needed to find the maximum throughput of oil.
   
2. Given an undirected graph with vertices numbered $1, 2, . . . , n$​, partition the vertices into two disjoint subsets such that vertex 1 and n are in different subsets, and the number of edges with both ends in the same subset is maximised.

   > The problem can be modelled as a max flow problem. Let vertex 1 be the source and vertex $n$​​​​​ be the sink. Let the edges between each vertices in the graph be replaced by two directed edges in opposite directions with a maximum capacity of 1. Use the Edmonds Karp algorithm to find the maximum flow in the network. By the min cut/max flow problem, we can maximise both ends in the subset by finding the total capacity of the edges that crosses the minimum cut in the max flow. If we minimises the edges that crosses the cut, this is equivalent in maximising the both ends in the same subset.

3. Assume that you are given a network flow graph with a source $s$, a sink $t$ and two other distinct vertices $u$ and $v$. Design an algorithm which returns a smallest capacity cut among all cuts for which the vertex $u$ is in the same side of the cut as the source $s$ and vertex $v$ is in the same side as the sink $t$​ and which runs in polynomial time.

   >Let the edges in the network flow graph be replaced as directed edges with a capacity of 1. Construct an edge connecting from $s$​ to $u$​ and an edge from $t$​ to $v$​ with a maximum capacity of infinity. Using the Edmonds Karp algorithm, find the maximum flow of the network. After argumenting all possible paths, find the minimum cut in the graph. Since we constructed from $s$​ to $u$​ and $t$​ to $u$​ to have infinite capacity, this edge would not be included in the minimal cut. Thus, we have found the smallest capacity of all cuts for which the vertex $u$​ is in the same side of the cut as the source $s$​ and vertex $v$​ is in the same side as the sink $t$​​​. The complexity of this algorithm is $O(V \times |E|^2)$​
   
4. Assume that you are given a network flow graph with a source $s$, a sink $t$ and two other distinct vertices $u$ and $v$. Design an algorithm which returns a smallest capacity cut among all cuts for which vertices $u$ and $v$ are in the same side of the cut.

   >Let the edges in the network flow graph be replaced by a directed edges with capacity of 1. Construct a pair of directed edges in opposite directions connecting from $v$​ to $u$​ with a maximum capacity of infinity​. Use the Edmonds Karp algorithm to find the maximum flow in the network. We can use a minimum cut to find the smallest capacity of all cuts for which $v$ and $v$ are in the same side of the partition. This is because the minimum cut would not contain an edge with an infinite capacity, which we constructed an edge from $u$ to $v$. The complexity of the algorithm is $O(V \times |E|^2)$​ as the Edmonds Karp algorithm operation costing the highest.

5. You know that $n + 2$​ spies $S, s_1, s_2, . . . , s_n$​ and $T$ are communicating through certain number of communication channels; in fact, for each $i$ and each $j$ you know if there is a channel through which spy $s_i$ can send a secret message to spy $s_j$​ or if there is no such a channel (i.e., you know what the graph looks like, with spies as vertices and communication channels as directed edges). 

   (a) Your task is to design an algorithm which finds the fewest number of channels which you need to compromise (for example, by placing a listening device on that channel) so that spy $S$​ cannot send a message to spy $T$​​ through a sequence of intermediary spies without the message being passed through at least one compromised channel.

   >This problem can be represented as a max flow/min cut problem. Construct a network flow graph $G(V,E)$​​​​ such that spies $S, s_1,s_2...,s_n, T$​​​​​ are the vertices and the communication channels are the directed edges with the maximum capacity of 1, going in the direction from spy $s_i$​​​ to $s_j$​​​​. Let spy $S$​​ be the source and spy $T$​​ be the sink.
   >
   >Use a max flow algorithm such as the Edmonds Karp algorithm to find the maximum flow of the network. After argumenting the final path in the network flow, we can use a minimum cut to find fewest number of channels to comprimise since, since the edges on a minimum cut gives us all paths that connects spy $S$ to spy $T$​. The time complexity of the algorithm is $O(V \times |E|^2)$​​ since the Edmonds Karp algorithm is the highest operation cost of this algorithm.
   
   (b) Assume now that you cannot compromise channels because they are encrypted, so the only thing you can do is bribe some of the spies. Design an algorithm which finds the smallest number of spies which you need to bribe so that $S$ cannot send a message to $T$​​ without the message going through at least one of the bribed spies as an intermediary.
   
   https://edstem.org/courses/5966/discussion/532766
   
   > Similar to question a, construct a network flow graph $G(V,E)$ with the same conditions except all edges are set to have a maximum capacity of infinity. By setting the max capacity to infinity, this ensures that no communication channels are considered when performing a minimum cut to find the smallest number of spies. However, to find the smallest number of spies to bribe, the approach is to find the max flow with vertex capacities. For every vertex except the source and sink, split the vertex into two nodes $v_i$ and $v_j$​​ such that all incoming edges is now instead incident to $v_i$​ and all outgoing edges are now incident to  $v_j$. Connect $v_i$ and $v_j$​ with an edge of maximum capacity of 1 since there are one spy per vertex to consider.
   >
   > Use Edmonds Karp algorithm to find the max flow and after argumenting the final path, perform a minimum cut. The total capacity of the edges crossed in the minimum cut is the smallest number of spies which you need to bribe. 
   
6. There are $N$​ cities (labelled $1, 2, . . . , N$​), connected by $M$​ bidirectional roads. Each road connects two different cities. A pair of cities may be connected by multiple roads. A well known criminal is currently in city 1 and wishes to get to city $N$​​ via road. To catch the criminal, the police have decided to block the minimum number of roads possible to make it impossible to get from city 1 to city $N$​​. However, some roads are major roads. In order to avoid disruption, the police cannot close any major roads. Find the minimum number of roads to block to prevent the criminal from going from city 1 to city $N$​, or output -1 if the police cannot stop the criminal.

   > The problem can be represented as a max flow/min cut problem. Construct a flow network graph $G(V,E)$ such that the $N$ cities are represented as vertices and the $M$ bidirectional roads are represented as a pair of directed edges in opposite direction to each other. If the $i^{th}$​ road is a major road, set the maximum capacity to infinity. Otherwise, set 1 as the max capacity. Let also city 1 be the source and city $N$ be the sink.
   >
   > Use the Edmonds Karp algorithm to find the max flow in the network starting from city 1 to city $N$. Perform a minimum cut on the graph. If the total capacity of the minimum cut $\le M$, then the total capacity of the edges that crosses the cut is the minimum number of roads to prevent the criminal from going from city 1 to city $N$​. Otherwise, a major road is required to block the criminal which means there exists no solution and thus return -1.
   >
   > The total time complexity of this algorithm is $O(V \times |E|^2)$ as the Edmonds Karp algorithm has the highest operation cost.​

7. An $n \times n$ grid is an undirected graph consisting of $n$ rows, each row containing $n$ vertices, with vertices connected with edges to all of their immediate neighbours (2 at all of the 4 corners, 3 at all of the 4 sides and 4 in the interior of the grid). Vertices with exactly 4 neighbours are called the internal vertices; vertices with exactly 3 neighbours are called the side vertices. The escape problem is, given $m \le 4(n − 1)$ many internal vertices in the grid and $m$ side vertices on the 4 sides of the grid, connect each of $m$ many distinct internal vertices with distinct $m$ side vertices by non intersecting paths or return impossible when there is no such a solution. Note that any of $m$ internal vertices can be connected to any of $m$​ side vertices.

   > This problem can be represented as a max flow/min cut problem. Let the $n \times n$​ grid be a network flow graph with the edges replaced by a pair of two directed edges in the opposite direction to each other with a maximum capacity of 1. Let the $m$​ internal vertices be represented as the souce and the $m$​ side vertices as the sinks. Let the internal vertices have an internal capacity of 1 using the vertex splitting method such that it ensires non intersecting paths. Also, let there be a super source vertex $S$​ that connects to the $m$​ internal vertices and a super sink $T$​ that connects to the $m$​​ side vertices. Set the maximum capacity of these edges to the super source/sink to be infinity.
   >
   > Use the Edmonds Karp algorithm to find the maximum flow in the graph. After argumenting the final path, use the minimum cut on the network. If the total capacity of the edges that crosses the cut equals to $m$, there exists $m$ non intersecting paths that connect the $m$ internal vertices to the $m$​ side vertices. Otherwise, there exists no solution.
   
8. A band of $M$ criminals has infiltrated a secure building, which is structured as an $N \times N$ square grid of rooms, each of which has a door on all of its sides. Thus: from an internal room, we can move to any of the four neighbouring rooms, from a room on the side of the building, we can move to three other rooms or leave the building, and from a corner room, we can move to two other rooms or leave the building. The criminals were able to shut down the building’s security system before entering, but during their nefarious activities, the security system became operational again, so they decided to abort the mission and attempt to escape. The building has a sensor in each room, which becomes active when an intruder is detected, but only triggers the alarm if it is activated again. Thus, the criminals may be able to escape if they can all reach the outside of the building without any two of them passing through a same room. Given the $M$​ different rooms which the criminals occupy when the security system is reactivated, determine whether all $M$​ criminals can escape without triggering the alarm.

   > The problem can be represented as a max-flow/min-cut problem. Construct a flow network $G(V,E)$​ such that the rooms in the $N \times N$​ square grid are represented as vertices and the doors moving that moves from one room to the other represents a pair of directed edges in opposite direction to each other with a maximum capacity of 1. To begin with solving the problem, let the $M$​​ different rooms which the criminals occupy be the source vertices and the rooms on the side or coner of the building be represented as the sinks. Let the internal vertices have an internal capacity of 1 using the vertex splitting method such that it ensures that a theif cannot go into more than once. Let there exists a super source $S$​​ which connects to all source vertices and a super sink $T$​​ which connects to all sinks and set the maximum capacity of these edges to be infinity. Use the Edmonds Karp algorithm to find the maximum flow. Then, we use a minimum cut and take the total capacity of the edges, lets call $P$,​ that crosses the cut. If the total capacity equals to $M$​​, then all crimincals can escape without trggering the alarm. Otherwise, only $M - P$​ can only escape the building.

9. Several families are coming to a birthday celebration at a restaurant. You have arranged that $v$ many tables will serve only vegetarian dishes, $p$ many tables will not serve pork and $r$ many remaining tables will serve food with pork. You know that $V$ many families are all vegetarians, $P_1$ many families do not eat pork but do not mind eating vegetarian dishes, $P_2$ many families do not eat pork but hate vegetarian dishes. Also $R_1$ many families have no dietary restrictions and would also not mind eating vegetarian dishes or food without pork, $R_2$ many families have no dietary restrictions but hate vegetarian dishes but can eat food without pork. Finally, $S$​​ many families are from Serbia and cannot imagine not eating pork. You are also given the number of family members in each family and the number of seats at each table. Your conundrum is to place the guests at the tables so that their food preferences are respected and no two members from the same family sit at the same table. In case the problem has no solutions your algorithm should output statement “no solution”.

   > This problem can be visualised as a max flow/min cut problem. Construct a flow network bipartite graph $G(V,E)$ such that the families as the vertices on the left side and the tables $v$, $p$ and $r$ are represented as vertices on the right side of the graph. Each family can be placed on a certain table based on their dietry requirements. The table below shows which possible tables that a family member can be placed.
   >
   > | Families | Tables    |
   > | -------- | --------- |
   > | $V$      | $v$       |
   > | $P_1$    | $p$, $v$  |
   > | $P_2$    | $p$       |
   > | $R_1$    | $p, v, r$ |
   > | $R_2$    | $p,v$     |
   > | $S$      | $p,v$     |
   >
   > As such for each family, create a pair of directed egdes with opposite orientation on the graph to connect to their respective table(s) listed above. (i.e. an directed edge will connect both node $V$ and $v$​). Since no two family members can sit at a table, set the maximum capacity of these edges to be 1.
   >
   > Let there also be a super source $S$​​ that connects to all vertices that represents the families. Set the maximum capacity of the edges from the source to the families to be number of family members with the corresponding edge. Let there also be a super sink $T$​ that connects all tables to the sink, with the maximum capacity set to the capacity of each table.
   >
   > Use the Edmonds Karp algorithm to find the maximum flow. After argumenting the final path, use a minimum cut on the graph to find the total capacity of family members that can be placed on a table with their food preferences. If the total capacity of the minimum cut equals to the total family members at the birthday celebrate, there exists a solution. Otherwise, the problem has no solution and the algorith returns "no solution". To find the combination to place the guests, we can look at the which incoming edge connected to the table vertices that it is connected to. The overall time complexity is $O(|V| \times |E|^2)$​​ as the Edmonds Karp algorithm costs the mosts overhead.​

10. **TODO**: Today was just a regular day for everyone in Krypton until a news flashed that a meteor is going to destroy Krypton in $X$ days. Krypton has $N$​ cities, some of which are connected by bidirectional roads. You are given a road map of Krypton; for every two cities $C_i$ and $C_j$ which are connected by a (direct) road from $C_i$ straight to $C_j$ you are given the value $t(i, j)$ which is the number of days to travel from city $C_i$ to city $C_j$ . (You can of course also go from a city $C_m$ to city $C_k$ without a direct road from $C_m$ to $C_k$ by going through a sequence of intermediate cities connected by direct roads.) In each city $C_i$ the Krypton Government built $q_i$ pods to carry inhabitants in case of any calamity, which will transport them to Earth. City $C_i$ has population $p_i$​ . As soon as the people hear this news they try to save themselves by acquiring these pods either at their own city or in other city before the meteor destroys everything. Note that a pod can carry only one person. Find the largest number of invaders the Earth will have to deal with.

    > The problem can be modelled as a max flow/min cut problem. Construct a network flow graph $G(V,E)$ such that the $N$ cities are represented as vertices and the bidrectional roads connecting every two cities $C_i$ and $C_j$ are a pair of directed edges in opposite orientation with a maximum capacity of $t(i,j)$​​.​

11. **TODO**: You have been told of the wonder and beauty of a very famous painting. It is painted in the hypermodern style, and so it is simply an $N$ by $N$ grid of squares, with each square coloured either black or white. You have never seen this picture for yourself, but have been told some details of it by a friend. Your friend has told you the value of $N$​ and the number of white squares in each row and each column. Additionally, your friend has also been kind enough to tell you the specific colour of some squares: some squares are black, some are white, and the rest she simply could not remember. The more details she tells you, the more amazing this painting becomes but you begin to wonder that perhaps it’s simply too good to be true. Thus, you wish to design a polynomial time algorithm that determines whether or not such a painting can exist.

    > This problem can be visualised as a max flow problem. Construct a bipartite network flow graph $G(V,E)$ such that there exists a vertex for representing the $N$ rows on the left side, which are the source. There are also vertices representing as the sink vertices for each of the $N$ columns. Now let there exists a super sink $S$ which connects to the $N$ rows. The capacity of the edge connecting to the $N$ rows is the number of white squares there are for that corresponding row. There also exists a super sink connecting to the $N$ column with a max capacity equal to the number of white squares for the corresponding column. For each row $r_i$, construct a pair of directed edges in opposite orientation connecting to every column vertex $c_j$ except for any square $(r_i, c_j)$​​ which is a white square and set the max capacity to be 1.
    >
    > Use the Edmonds Karp algorithm to find the max flow of the network. Use a minimum cut to find the total capacity on the edges that crosses the cut. If the total capacity $\lt N \times N$, then there exists no

## Lecture Problems

1. Assume you have a movie rental agency. At the moment you have $k$ movies in stock, with $m_i$ copies of movie $i$. Each of $n$​ customers can rent out at most 5 movies at a time. The customers have sent you their preferences which are lists of movies they would like to see. Your goal is to dispatch the largest possible number of movies.
2. The storage space of a ship is in the form of a rectangular grid of cells with $n$ rows and m columns. Some of the cells are taken by support pillars and cannot be used for storage, so they have 0 capacity. You are given the capacity of every cell; cell in row $r_i$ and column $c_j$ has capacity $C(i, j)$. To ensure the stability of the ship, the total weight in each row $r_i$ must not exceed $C(r_i)$ and the total weight in each column $c_j$ must not exceed $C(c_j)$. Find how to allocate the cargo weight to each cell to maximise to total load without exceeding the limits per column, limits per row and limits per available cell.
3. You are given a connected, directed graph $G$ with $N$ vertices. Out of these $N$ vertices $k$ are painted red, $m$ are painted blue, and the remaining $N − k − m > 0$​ of the vertices are black. Red vertices have only outgoing edges and blue vertices have only incoming edges. Your task is to determine the largest possible number of disjoint (i.e., non-intersecting) paths in this graph, each of which starts at a red vertex and finishes at a blue vertex.
4. You are taking two kinds of medicines, $A$ and $B$; pills of $A$ are completely indistinguishable from pills of $B$. You take one of each every day and they both come in supply of 30 pills. One day you drop both bottles on the floor and you see that 3 pills have fallen on the floor but you do not know how many from each bottle and you cannot tell which ones (if any) are of type $A$ and which are of type $B$. How can you solve the problem of continuing to take 1 of each every day without throwing away any pills?
